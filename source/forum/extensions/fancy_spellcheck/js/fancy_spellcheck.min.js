if(typeof PUNBB==="undefined"||!PUNBB){var FORUM={};}PUNBB.fancy_spellcheck=(function(){var k=null,f=null,g=null,j=null,l=null,c=0;function o(){var s={};if($.cookie("yandex.spell")&&$.cookie("yandex.spell").length>1){var r=unescape($.cookie("yandex.spell")).split("&");for(var q=0;q<r.length;++q){var t=r[q].split("=");s[t[0]]=unescape(t[1]||"");}}return s;}function i(q){var r=(j.length)?j.val()+"\n"+g.val():g.val();return(q)?e(r):r;}function m(q){if(q){return encodeURIComponent(i(true)).length;}else{return i().length;}}function e(q){var r=q.replace(/^\s+|\s+$/g,"");r=r.replace(/\[img\]\S+\[\/img\]/g," ");return r;}function b(s,t){if(l.hasClass("busy")){return;}var u=o(),r=false,q=false,v="";function y(){if(r&&q){l.removeClass("busy");if(v&&typeof v==="object"){if(v.length===0){s();}else{t(v);}}else{alert("Сервис проверки правописания не отвечает.");}}}$(document).stopTime("fancy_check_spelling_ok");$("#fancy_check_spelling_ok").css("opacity","0");if(m(false)<3){_.delay(s);return;}if(c===$.sha1(i())){_.delay(s);return;}if(m(true)>6000){_.delay(h);return;}l.addClass("busy").blur();$(document).oneTime(750,"fancy_checkspell_uit",function(){r=true;y();});$(document).stopTime("fancy_checkspell_error").oneTime(10000,"fancy_checkspell_error",function(){r=true;q=true;y();});if(PUNBB.env.user_lang=="English"){_def_lang="en,ru";}else{_def_lang="ru";}var x=u.lang||_def_lang,w=parseInt(p(u.options)||22,10);if(x=="en"){w&=~144;}else{if((w&144)==0){x+=",en";}}$.ajax({type:"GET",url:"http://speller.yandex.net/services/spellservice.json/checkText",data:{text:i(true),lang:x,options:w},dataType:"jsonp",global:false,success:function(A,z){$(document).stopTime("fancy_checkspell_error");q=true;v=A||"";y();}});}function a(){c=$.sha1(i());$("#fancy_check_spelling_ok").fadeTo(250,1,function(){$(document).stopTime("fancy_check_spelling_ok").oneTime(2000,"fancy_check_spelling_ok",function(){$("#fancy_check_spelling_ok").fadeTo(250,0);});});}function h(r){var s=[],v=0,x=r||null,w=o();if(x&&x.length>0){v=x.length;var t=d();_.each(x,function(y){if(y.code!==2&&t&&typeof(t[n(y.word)])!="undefined"){v-=1;return true;}});if(v===0){a();return;}}if(PUNBB.env.user_lang=="English"){_def_lang="en,ru";}else{_def_lang="ru";}var u=w.lang||_def_lang,q=parseInt(p(w.options)||22,10);if(u=="en"){q&=~144;}else{if((q&144)==0){u+=",en";}}f=new Speller({url:PUNBB.env.fancy_spellcheck.speller_url,lang:u,options:q});if(s.length<1){if(j.length){s.push(document.getElementById(j.attr("id")));}s.push(document.getElementById(g.attr("id")));}f.check(s);}function d(){var t=String(PUNBB.fancy_spellcheck_storage_local.getItem("yandex.userdic")||""),q=t.split("\n");items={};for(var r=0;r<q.length;++r){var s=n(q[r]);if(s){this.items[s]="";}}return items;}function n(q){return q.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"");}function p(q){return typeof(q)=="undefined"?"":q.toString();}return{init:function(){g=$('textarea[name="req_message"]').length?$('textarea[name="req_message"]'):$('textarea[name="signature"]');j=$('input[name="req_subject"]').length?$('input[name="req_subject"]'):"";var q=$("#fancy_spellcheck_block");if(!q||!g.length){return;}k=$("#fancy_spellcheck_link");l=$("#fancy_spellcheck_span");$(document).bind("check.fancy_spellcheck",function(){b(a,h);});k.bind("click",function(){b(a,h);});}};}());PUNBB.common.addDOMReadyEvent(PUNBB.fancy_spellcheck.init);function Speller(b){b=b||{};this.url=b.url||".";this.args={defLang:b.lang||"ru",defOptions:b.options||4,spellDlg:b.spellDlg||{width:550,height:550},optDlg:b.optDlg||{width:450,height:480},userDicDlg:b.userDicDlg||{width:400,height:450}};}Speller.IGNORE_UPPERCASE=1;Speller.IGNORE_DIGITS=2;Speller.IGNORE_URLS=4;Speller.FIND_REPEAT=8;Speller.IGNORE_LATIN=16;Speller.FLAG_LATIN=128;Speller.prototype.check=function(b){this.showDialog(this.url+"/spelldlg.html",this.args.spellDlg,b);};Speller.prototype.optionsDialog=function(){this.showDialog(this.url+"/spellopt.html",this.args.optDlg);};Speller.prototype.showDialog=function(i,h,m){var n=this.args,l={ctrls:m,lang:n.lang,options:n.options,defLang:n.defLang,defOptions:n.defOptions,optDlg:n.optDlg,userDicDlg:n.userDicDlg},k=m=0;if(window.outerWidth){m=window.screenX+(window.outerWidth-h.width>>1);k=window.screenY+(window.outerHeight-h.height>>1);}if(window.showModalDialog&&navigator.userAgent.indexOf("Opera")<0){h="dialogWidth:"+h.width+"px;dialogHeight:"+h.height+"px;scroll:no;help:no;status:no;";if(navigator.userAgent.indexOf("Firefox")>=0){h+="dialogLeft:"+m+"px;dialogTop:"+k+"px;";}window.showModalDialog(i,l,h);n.lang=l.lang;n.options=l.options;}else{var j=i.replace(/[\/\.]/g,"");h="width="+h.width+",height="+h.height+",toolbar=no,status=no,menubar=no,directories=no,resizable=no";if(m||k){h+=",left="+m+",top="+k;}window.theDlgArgs=l;window.open(i,j,h).onunload=function(){n.lang=l.lang;n.options=l.options;};}};PUNBB.fancy_spellcheck_storage_local=(function(){var b=null,a=false;return{init:function(){try{if(window.localStorage){b=window.localStorage;a=true;return;}if(window.globalStorage){b=window.globalStorage[document.domain];
a=true;return;}}catch(c){a=false;}},setItem:function(c,d){if(!a){return false;}b.setItem(c,d);},getItem:function(c){if(!a){return null;}return b.getItem(c);},removeItem:function(c){if(!a){return null;}b.removeItem(c);},clear:function(){if(!a){return null;}b.clear();},supported:function(){return a;}};}());PUNBB.common.addDOMReadyEvent(PUNBB.fancy_spellcheck_storage_local);